#!/bin/bash

echo "ğŸ” Render Deployment Debug Script"
echo "================================="

echo ""
echo "ğŸ“‹ Checking project structure..."
if [ -d "frontend" ]; then
    echo "âœ… frontend directory exists"
else
    echo "âŒ frontend directory missing"
fi

if [ -d "backend" ]; then
    echo "âœ… backend directory exists"
else
    echo "âŒ backend directory missing"
fi

if [ -f "render.yaml" ]; then
    echo "âœ… render.yaml exists"
else
    echo "âŒ render.yaml missing"
fi

echo ""
echo "ğŸ”§ Testing frontend build..."
cd frontend
if npm run build > /tmp/build.log 2>&1; then
    echo "âœ… Frontend builds successfully"
    if [ -d "dist" ]; then
        echo "âœ… dist directory created"
        echo "ğŸ“ Build output:"
        ls -la dist/ | head -10
    else
        echo "âŒ dist directory not created"
    fi
else
    echo "âŒ Frontend build failed"
    echo "ğŸ“„ Build errors:"
    cat /tmp/build.log
fi
cd ..

echo ""
echo "ğŸ”§ Testing backend setup..."
cd backend
if python3 -c "import fastapi, uvicorn, firebase_admin; print('âœ… All dependencies available')" 2>/dev/null; then
    echo "âœ… Backend dependencies available"
else
    echo "âŒ Backend dependencies missing"
    echo "ğŸ’¡ Run: pip install -r requirements.txt"
fi
cd ..

echo ""
echo "ğŸ“ Configuration checklist:"
echo "1. [ ] Set VITE_FIREBASE_* environment variables in Render"
echo "2. [ ] Upload Firebase service account JSON file"
echo "3. [ ] Set FIREBASE_SERVICE_ACCOUNT_PATH variable"
echo "4. [ ] Verify JWT_SECRET is auto-generated by Render"
echo "5. [ ] Check CORS configuration in backend/main.py"

echo ""
echo "ğŸŒ Common Render URLs:"
echo "Frontend: https://your-service-name.onrender.com"
echo "Backend: https://your-backend-service.onrender.com"
echo "Health check: curl https://your-backend-service.onrender.com/docs"

echo ""
echo "ğŸ”§ If you get 404 errors:"
echo "1. Check if the service is deployed and running in Render dashboard"
echo "2. Verify the build completed successfully"
echo "3. Check environment variables are set correctly"
echo "4. Look at the service logs in Render dashboard"

echo ""
echo "ğŸ“ Need help? Check:"
echo "- Render dashboard logs"
echo "- Firebase console for authentication errors"
echo "- Browser developer tools for frontend errors"
