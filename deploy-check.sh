#!/bin/bash

echo "ğŸš€ Delivery Website - Pre-Deployment Checklist"
echo "=============================================="

# Check if required files exist
echo "ğŸ“ Checking required files..."
if [ -f "render.yaml" ]; then
    echo "âœ… render.yaml found"
else
    echo "âŒ render.yaml missing"
fi

if [ -f "backend/requirements.txt" ]; then
    echo "âœ… backend/requirements.txt found"
else
    echo "âŒ backend/requirements.txt missing"
fi

if [ -f "frontend/package.json" ]; then
    echo "âœ… frontend/package.json found"
else
    echo "âŒ frontend/package.json missing"
fi

if [ -f ".env.example" ]; then
    echo "âœ… .env.example found"
else
    echo "âŒ .env.example missing"
fi

echo ""
echo "ğŸ”§ Checking backend configuration..."
cd backend
if python3 -c "import fastapi, uvicorn, firebase_admin" 2>/dev/null; then
    echo "âœ… Backend dependencies can be imported"
else
    echo "âŒ Backend dependencies missing - run: pip install -r requirements.txt"
fi
cd ..

echo ""
echo "ğŸ”§ Checking frontend configuration..."
cd frontend
if npm list --depth=0 2>/dev/null | grep -q "vite"; then
    echo "âœ… Frontend dependencies installed"
else
    echo "âŒ Frontend dependencies missing - run: npm install"
fi
cd ..

echo ""
echo "ğŸ“ Environment Variables Check:"
echo "The following environment variables need to be set in Render:"
echo "- VITE_FIREBASE_API_KEY"
echo "- VITE_FIREBASE_AUTH_DOMAIN"
echo "- VITE_FIREBASE_PROJECT_ID"
echo "- VITE_FIREBASE_STORAGE_BUCKET"
echo "- VITE_FIREBASE_MESSAGING_SENDER_ID"
echo "- VITE_FIREBASE_APP_ID"
echo "- VITE_FIREBASE_MEASUREMENT_ID"
echo "- FIREBASE_SERVICE_ACCOUNT_PATH"
echo "- JWT_SECRET (auto-generated by Render)"

echo ""
echo "ğŸŒ Testing local build..."
echo "Testing frontend build..."
cd frontend
if npm run build 2>/dev/null; then
    echo "âœ… Frontend builds successfully"
else
    echo "âŒ Frontend build failed"
fi
cd ..

echo ""
echo "Testing backend startup..."
cd backend
if python3 -c "from main import app; print('âœ… Backend imports successfully')" 2>/dev/null; then
    echo "âœ… Backend imports successfully"
else
    echo "âŒ Backend has import errors"
fi
cd ..

echo ""
echo "ğŸ“‹ Next Steps:"
echo "1. Set up your environment variables in Render dashboard"
echo "2. Upload your Firebase service account JSON file"
echo "3. Deploy using the render.yaml configuration"
echo "4. Test the deployed application"
echo "5. Update CORS settings for production"

echo ""
echo "ğŸ‰ Pre-deployment check complete!"
